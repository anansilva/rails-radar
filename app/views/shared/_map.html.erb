<div id="map"></div>


<% content_for(:after_js) do %>
  <%= javascript_tag do %>
      styles = [
             {
                 "featureType": "all",
                 "elementType": "labels.text.fill",
                 "stylers": [
                     {
                         "saturation": 36
                     },
                     {
                         "color": "#333333"
                     },
                     {
                         "lightness": 40
                     }
                 ]
             },
             {
                 "featureType": "all",
                 "elementType": "labels.text.stroke",
                 "stylers": [
                     {
                         "visibility": "on"
                     },
                     {
                         "color": "#ffffff"
                     },
                     {
                         "lightness": 16
                     }
                 ]
             },
             {
                 "featureType": "all",
                 "elementType": "labels.icon",
                 "stylers": [
                     {
                         "visibility": "off"
                     }
                 ]
             },
             {
                 "featureType": "administrative",
                 "elementType": "geometry.fill",
                 "stylers": [
                     {
                         "color": "#fefefe"
                     },
                     {
                         "lightness": 20
                     }
                 ]
             },
             {
                 "featureType": "administrative",
                 "elementType": "geometry.stroke",
                 "stylers": [
                     {
                         "color": "#fefefe"
                     },
                     {
                         "lightness": 17
                     },
                     {
                         "weight": 1.2
                     }
                 ]
             },
             {
                 "featureType": "landscape",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#f5f5f5"
                     },
                     {
                         "lightness": 20
                     }
                 ]
             },
             {
                 "featureType": "poi",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#f5f5f5"
                     },
                   {
                       "lightness": 21
                   }
               ]
           },
             {
                 "featureType": "poi.park",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#dedede"
                     },
                     {
                         "lightness": 21
                     }
                 ]
             },
             {
                 "featureType": "road.highway",
                 "elementType": "geometry.fill",
                 "stylers": [
                     {
                         "color": "#ffffff"
                     },
                     {
                         "lightness": 17
                     }
                 ]
             },
             {
                 "featureType": "road.highway",
                 "elementType": "geometry.stroke",
                 "stylers": [
                     {
                         "color": "#ffffff"
                     },
                     {
                         "lightness": 29
                     },
                     {
                         "weight": 0.2
                     }
                 ]
             },
             {
                 "featureType": "road.arterial",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#ffffff"
                     },
                     {
                         "lightness": 18
                     }
                 ]
             },
             {
                 "featureType": "road.local",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#ffffff"
                     },
                     {
                         "lightness": 16
                     }
                 ]
             },
             {
                 "featureType": "transit",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#f2f2f2"
                     },
                     {
                         "lightness": 19
                     }
                 ]
             },
             {
                 "featureType": "water",
                 "elementType": "geometry",
                 "stylers": [
                     {
                         "color": "#e9e9e9"
                     },
                     {
                         "lightness": 17
                     }
                 ]
             },
             {
                 "featureType": "water",
                 "elementType": "geometry.fill",
                 "stylers": [
                     {
                         "saturation": "0"
                     },
                     {
                         "color": "#bab9b9"
                     }
                 ]
             }
         ]


    var handler = Gmaps.build('Google');

    var iconBase = 'http://res.cloudinary.com/dsmei8zni/image/upload/v1510754575/marker.png';


    handler.buildMap({
      internal: { id: 'map' }
    }, function() {
      markers = handler.addMarkers(<%= raw @hash.to_json %>);
      handler.bounds.extendWith(markers);

      handler.fitMapToBounds();

      if (markers.length == 0) {
        handler.getMap().setZoom(2);
      } else if (markers.length == 1) {
        handler.getMap().setZoom(14);
      }
    });
 <% end %>
<% end %>
